┌─────────────────────────────────────────────────────────────────────────────┐
│                          UPS CONTROLLER WIRING                               │
└─────────────────────────────────────────────────────────────────────────────┘

                    60W Power Supply
                    ┌─────────────┐
                    │  5V   3.3V  │
                    │  ▼     ▼    │
                    │  │     │    │
                    └──┼─────┼────┘
                       │     │ (not used)
                       │     
        ┌──────────────┼──────────────┐
        │              │              │
        │              │              │
    ┌───▼────┐     ┌───▼────┐    ┌───▼────┐
    │ 100µF  │     │ 100µF  │    │  SG90  │
    │  Cap   │     │  Cap   │    │ SERVO  │
    │   +    │     │   +    │    │        │
    └───┬────┘     └───┬────┘    │ ┌────┐ │
        │              │          │ │ ── │ │  Horn (for pressing button)
        │              │          │ └────┘ │
        GND            GND        │        │
                                  │  Pins: │
                                  │  [B][R][O]
                                  └───┬─┬─┬┘
                                      │ │ │
                                      │ │ └─── Orange (Signal)
                                      │ └───── Red (VCC)
                                      └─────── Brown (GND)

    ESP32 DevKit-C V4
    ┌─────────────────────────────────┐
    │                    ┌──┐         │
    │                    │  │ USB     │
    │                    └──┘         │
    │  3V3 ●                       ●  GND ────┐
    │  EN  ●                       ●  23      │
    │  VP  ●                       ●  22      │
    │  VN  ●                       ●  TX      │
    │  34  ●                       ●  RX      │
    │  35  ●                       ●  21      │
    │  32  ●                       ●  19      │
    │  33  ●                       ●  18      │
    │  25  ●                       ●  5       │
    │  26  ●                       ●  17      │
    │  27  ●                       ●  16      │
    │  14  ●                       ●  4       │
    │  12  ●                       ●  0       │
    │  GND ●                       ●  2 ──┐   │ (Built-in LED)
    │  13  ●─┐                     ●  15  │   │
    │  SD2 ● │                     ●  SD1 │   │
    │  SD3 ● │                     ●  SD0 │   │
    │  CMD ● │                     ●  CLK │   │
    │  5V  ●─┼─────────────────────────────┼──┼─── From PSU 5V rail
    │        │                             │  │
    └────────┼─────────────────────────────┼──┼───
             │                             │  │
             │    ┌──────────────┐         │  │
             │    │    1kΩ       │         │  │
             └────┤   Resistor   ├─────────┼──┘
                  │  (Optional)  │         │
                  └──────────────┘         │
                         │                 │
                         └─────────────────┘
                                │
                                └─── To Servo Orange wire


CONNECTIONS SUMMARY:
┌────────────────┬─────────────────┬──────────────────────────┐
│ FROM           │ TO              │ NOTES                    │
├────────────────┼─────────────────┼──────────────────────────┤
│ PSU 5V         │ ESP32 5V pin    │ Power for ESP32          │
│ PSU 5V         │ Servo Red       │ Servo power (DO NOT use  │
│                │                 │ ESP32 3.3V!)             │
│ PSU GND        │ ESP32 GND       │ Common ground            │
│ PSU GND        │ Servo Brown     │ Common ground            │
│ ESP32 GPIO 13  │ 1kΩ resistor    │ Signal protection        │
│ 1kΩ resistor   │ Servo Orange    │ PWM signal to servo      │
│ 100µF cap +    │ 5V rails        │ Power smoothing          │
│ 100µF cap -    │ GND             │ Near ESP32 and servo     │
└────────────────┴─────────────────┴──────────────────────────┘

NOTES:
- 1kΩ resistor on signal line is OPTIONAL but recommended
- 100µF capacitors are REQUIRED near servo (prevents voltage drops)
- Place second 100µF cap near ESP32 VIN pin
- Keep servo power wires short and thick (prevents voltage drop)
- Servo can draw 500mA+ during movement - PSU must handle this

┌─────────────────────────────────────────────────────────────────────────────┐
│                        LIGHTS CONTROLLER WIRING                              │
└─────────────────────────────────────────────────────────────────────────────┘

                    60W Power Supply
                    ┌─────────────┐
                    │  5V   3.3V  │
                    │  ▼     ▼    │
                    └──┼─────┼────┘
                       │     │ (not used)
                       │     
        ┌──────────────┼──────────────┬──────────────┬──────────────┐
        │              │              │              │              │
        │              │              │              │              │
    ┌───▼────┐     ┌───▼────────┐ ┌──▼───────────┐ ┌──▼───────────┐
    │ 100µF  │     │ TPS259807  │ │ TPS259807    │ │ TPS259807    │
    │  Cap   │     │ eFuse #1   │ │ eFuse #2     │ │ eFuse #3     │
    │   +    │     │            │ │              │ │              │
    └───┬────┘     │ ┌────────┐ │ │ ┌──────────┐ │ │ ┌──────────┐ │
        │          │ │Pin Cfg │ │ │ │Pin Cfg   │ │ │ │Pin Cfg   │ │
        GND        │ └────────┘ │ │ └──────────┘ │ │ └──────────┘ │
                   │            │ │              │ │              │
                   │  1  ●●  8  │ │  1  ●●  8    │ │  1  ●●  8    │
                   │  2  ●●  7  │ │  2  ●●  7    │ │  2  ●●  7    │
                   │  3  ●●  6  │ │  3  ●●  6    │ │  3  ●●  6    │
                   │  4  ●●  5  │ │  4  ●●  5    │ │  4  ●●  5    │
                   │            │ │              │ │              │
                   └─┬──┬─┬─┬─┬─┘ └─┬──┬─┬─┬─┬──┘ └─┬──┬─┬─┬─┬──┘
                     │  │ │ │ │     │  │ │ │ │      │  │ │ │ │
        Pin 1: VIN ──┘  │ │ │ │     │  │ │ │ │      │  │ │ │ │
        Pin 2: GND ─────┘ │ │ │     │  │ │ │ │      │  │ │ │ │
        Pin 3: EN ────────┘ │ │     │  │ │ │ │      │  │ │ │ │
        Pin 4: NC ──────────┘ │     │  │ │ │ │      │  │ │ │ │
        Pin 5: VOUT ──────────┼─────┼──┼─┼─┘ │      │  │ │ │ │
        Pin 6: NC ────────────┘     │  │ │   │      │  │ │ │ │
        Pin 7: ILIM ────────────────┼──┼─┼───┼──────┼──┼─┼─┘ │
        Pin 8: GND (Thermal Pad) ───┘  │ │   │      │  │ │   │
                                       │ │   │      │  │ │   │
                                    Same connections for all 3 chips


    ESP32 DevKit-C V4
    ┌─────────────────────────────────┐
    │                    ┌──┐         │
    │                    │  │ USB     │
    │                    └──┘         │
    │  3V3 ●                       ●  GND ────┐
    │  EN  ●                       ●  23      │
    │  VP  ●                       ●  22      │
    │  VN  ●                       ●  TX      │
    │  34  ●                       ●  RX      │
    │  35  ●                       ●  21      │
    │  32  ●                       ●  19      │
    │  33  ●                       ●  18      │
    │  25  ●─────┐                 ●  5       │
    │  26  ●─────┼─────┐           ●  17      │
    │  27  ●─────┼─────┼─────┐     ●  16      │
    │  14  ●     │     │     │     ●  4       │
    │  12  ●     │     │     │     ●  0       │
    │  GND ●─────┼─────┼─────┼─────●  2       │ (Built-in LED)
    │  13  ●     │     │     │     ●  15      │
    │  SD2 ●     │     │     │     ●  SD1     │
    │  SD3 ●     │     │     │     ●  SD0     │
    │  CMD ●     │     │     │     ●  CLK     │
    │  5V  ●─────┼─────┼─────┼─────────────────── From PSU 5V rail
    │            │     │     │                 │
    └────────────┼─────┼─────┼─────────────────┘
                 │     │     │
          ┌──────┘     │     │
          │      ┌─────┘     │
          │      │     ┌─────┘
          │      │     │
          ▼      ▼     ▼
       [TPS1] [TPS2] [TPS3]  ← To Pin 3 (EN) of each TPS259807
       (EN)   (EN)   (EN)


    Current Limit Configuration (Per TPS259807)
    ┌─────────────────────────────────────┐
    │  Pin 7 (ILIM)                       │
    │       │                             │
    │       │    Rilim                    │
    │       └────/\/\/\────┐              │
    │              │        │             │
    │           ┌──┴──┐  ┌─┴─┐            │
    │           │10µF │  │GND│            │
    │           │ Cap │  └───┘            │
    │           └──┬──┘                   │
    │              │                      │
    │            ┌─┴─┐                    │
    │            │GND│                    │
    │            └───┘                    │
    └─────────────────────────────────────┘

    Rilim calculation: Rilim (kΩ) = 52000 / Ilimit(mA)
    
    Examples:
    • 1A limit: Rilim = 52kΩ
    • 2A limit: Rilim = 26kΩ  (use 27kΩ standard)
    • 3A limit: Rilim = 17.3kΩ (use 18kΩ standard)
    • 6A limit: Rilim = 8.7kΩ  (use 8.2kΩ standard)


    Output Load Connection (Each TPS259807)
    ┌────────────────────────────────────────────┐
    │  Pin 5 (VOUT)                              │
    │       │                                    │
    │       │    ┌──────┐                        │
    │       └────┤ 10µF │                        │
    │            │  Cap │                        │
    │            └───┬──┘                        │
    │                │                           │
    │              ┌─┴─┐                         │
    │              │GND│                         │
    │              └───┘                         │
    │                                            │
    │       VOUT ──────────► To LED Load         │
    │                        (IKEA lights)       │
    │       GND   ──────────► Load Ground        │
    └────────────────────────────────────────────┘


CONNECTIONS SUMMARY FOR EACH TPS259807:
┌────────────┬────────────────────┬─────────────────────────────┐
│ Pin #      │ Pin Name           │ Connection                  │
├────────────┼────────────────────┼─────────────────────────────┤
│ 1          │ VIN                │ PSU 5V + 100µF cap to GND   │
│ 2          │ GND                │ Common GND                  │
│ 3          │ EN (Enable)        │ ESP32 GPIO 25/26/27         │
│ 4          │ NC                 │ Not Connected               │
│ 5          │ VOUT               │ To Load + 10µF cap to GND   │
│ 6          │ NC                 │ Not Connected               │
│ 7          │ ILIM               │ Resistor to GND (see calc)  │
│ 8 (Pad)    │ GND (Thermal)      │ GND (solder to PCB plane)   │
└────────────┴────────────────────┴─────────────────────────────┘

COMPLETE WIRING TABLE:
┌────────────────┬─────────────────┬──────────────────────────┐
│ FROM           │ TO              │ COMPONENT                │
├────────────────┼─────────────────┼──────────────────────────┤
│ PSU 5V         │ ESP32 5V        │ Direct                   │
│ PSU 5V         │ TPS1 Pin 1      │ + 100µF cap              │
│ PSU 5V         │ TPS2 Pin 1      │ + 100µF cap              │
│ PSU 5V         │ TPS3 Pin 1      │ + 100µF cap              │
│ PSU GND        │ All GNDs        │ Common ground            │
│ ESP32 GPIO 25  │ TPS1 Pin 3      │ Enable signal            │
│ ESP32 GPIO 26  │ TPS2 Pin 3      │ Enable signal            │
│ ESP32 GPIO 27  │ TPS3 Pin 3      │ Enable signal            │
│ TPS1 Pin 7     │ Rilim + GND     │ Current limit (52kΩ/I)   │
│ TPS2 Pin 7     │ Rilim + GND     │ Current limit (52kΩ/I)   │
│ TPS3 Pin 7     │ Rilim + GND     │ Current limit (52kΩ/I)   │
│ TPS1 Pin 5     │ LED Load 1 +    │ + 10µF cap               │
│ TPS2 Pin 5     │ LED Load 2 +    │ + 10µF cap               │
│ TPS3 Pin 5     │ LED Load 3 +    │ + 10µF cap               │
│ Load GND       │ Common GND      │ Return path              │
└────────────────┴─────────────────┴──────────────────────────┘